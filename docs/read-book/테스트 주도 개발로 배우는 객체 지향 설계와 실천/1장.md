# 1장. 테스트 주도 개발의 핵심

## 소프트웨어 개발은 학습의 과정이다
- 흥미로운 프로젝트에는 예상치 못한 요소가 많음
- 개인이 시스템의 모든 가능성을 파악하기 힘듬(시스템을 전체적으로 이해하기 힘듬)
- 소프트웨어 개발을 진행하며, 기술이나 프로세스 등에 대해 점진적으로 배워나가야 하며, 불확실성은 이처럼 배워나가는 과정에서 줄어든다

## 피드백은 가장 기본적인 도구이다
점진적이고, 빠른 피드백을 통해 소프트웨어 개발을 발전시켜 나가야 한다.
- 배포를 해야만 피드백이 완전해졌다고 판단할 수 있다
- 중첩된 고리형 시스템의 피드백 주기 적용
    - 짝 프로그래밍, 단위 테스트, 인수테스트, 일별 회의, 반복주기, 출시 등을 사용
    - 하나의 고리마다 산출물이 나옴 ⇒ 피드백으로 드러남
    - 중첩된 피드백 고리는 서로를 강화
- 안쪽 고리는 기술적 세부 사항에 집중
- 바깥쪽 고리는 조직과 팀에 집중

## 변화를 돕는 실천법
시스템 규모를 믿을 수 있는 방식으로 키우고, 예상치 못한 변화에 대처하려면 두가지 기술적 토대 필요
- 수동 테스트를 자주 하는 것은 비실용적
- 코드를 단순화 하도록 항상 리팩토링 한다
- TDD를 한다

## 테스트 주도 개발
TDD를 통해 시스템 구현과 설계 품질에 대한 피드백을 얻는다.
- 테스트 주도 개발의 이점
    - 설계 아이디어 품질에 대한 피드백을 빨리 받는다
    - 물리적인 설계와 논리적인 설계를 분리한다
    - 개발 후 테스트를 만드는 고통에서 벗어남
    - 테스트 자동화, 자동화된 회귀 테스트
    - 변경에 대한 자신감
- 테스트를 작성하면
    - 다음 작업에 대한 인수 조건 명확해짐(설계)
    - 느슨하게 결합된 구성 요소 작성 ⇒ 모두 결합된 상태로 구성 요소 손쉽게 테스트(설계)
    - 완전한 회귀 스위트 증가(구현)
- 테스트를 실행하면
    - 컨텍스트를 선명하게 인지하는 동안 오류 탐지(구현)
    - 작업의 완료 시점을 알게 되어, 과도한 최적화나 불필요한 기능 추가를 하지 않음(설계)
- `TDD 황금률 : 실패하는 테스트 없이는 새 기능을 작성하지 말라`
- 작은 단위로 생각하고 설계해아한다

## 좀 더 큰 그림
애플리케이션 내의 클래스만을 대상으로 단위 테스트를 작성하는 것만으로는 충분하지 않다. 인수테스트(acceptance test)를 통해 만들고자하는 기능을 시험한다. 인수테스트가 끝나면 작업이 종료된다.
- `실패하는 인수테스트 작성 → 실패하는 단위테스트 작성 → 테스트 통과 → 리팩토링` 의 과정을 반복한다

## 전 구간 테스트(end-to-end test)
인수테스트에서는 시스템 내부 코드를 가능한 호출하지 않고 시스템 전 구간을 시험해야 함
시스템은 인수테스트가 모두 통과해야 배포

## 테스트의 수준
- 인수테스트 : 전체 시스템이 동작하는가?
- 통합 테스트 : 변경할 수 없는 코드를 대상으로 코드가 동작하는가?
- 단위 테스트 : 객체가 제대로 동작하는가? 객체를 이용하기가 편리한가?
- 인수테스트는 도메인 전문가와 함께 다음에 구축할 내용에 대해 이해하고 합의하는 데 도움을 받는 목적

## 외부 품질과 내부 품질
- **외부 품질**
    - 시스템이 고객과 사용자의 요구를 얼마나 잘 충족하는가(기능, 신뢰성, 가용성, 응답성 등)이다
    - 보통 계약의 일부라, 이를 이해하지 못할 사람은 없다
    - 전 구간 테스트를 사용한다
    - 전 구간 테스트로는 코드를 얼마나 잘 작성했는지는 알 수 없다
- **내부 품질**
    - 시스템이 개발자와 관리자의 요구를 얼마나 잘 충족하는가(이해하기 쉬운가, 변경하기 쉬운가) 이다
    - 외부 품질과 똑같이 중요하지만, 달성하기는 많이 어렵다
    - 단위 테스트를 사용한다
    - 단위 테스트로는 시스템이 전체적으로 동작하는지를 충분히 확신할 수 없다

### 내부 품질 향상
- `높은 응집과 낮은 결합`을 유지
    - 코드의 동작 방식을 얼마나 쉽게 바꿀 수 있는지를 설명하는 척도
    - 변경이 외부로 전파된다면 `높은 결합`을 의심
        - 이를 최대한 낮게 유지해야 한다
    - `응집도`는 해당 요소의 책임이 의미있는 단위를 형성하는지 나타내는 척도
        - 날짜와 URL을 파싱하는 기능이 같이 들어간 클래스는 응집도가 낮다고 표현할 수 있다
        - 그리고, 두 가지 기능을 다 잘할 가능성이 낮다
- 객체에 대한 단위테스트를 많이 해야한다
    - 객체를 생성하고, 객체의 의존성을 제공하며, 객체와 상호 작용하고, 예상대로 동작하는지 검사할 필요가 있다
- 설계를 잘못하면 단위 테스트를 작성하거나 이해하기 어렵다
    - 예를 들면 클래스가 멀리 떨어져있는 시스템의 일부와 긴밀하게 결합되어 있거나, 암시적인 의존성이 있거나, 불분명한 책임이 너무 많을때 등이 있다

결과적으로 `높은 응집과 낮은 결합`을 가진 객체가 많아야 높은 내부 품질을 유지할 수 있게 되는데, 테스트 작성이 이를 측정하는 기준점이 될 수 있다.TDD는 테스트를 먼저 작성함으로써, 이러한 설계에 관한 즉각적인 피드백을 바로 얻을 수 있다는 큰 장점이 있다.