# 테스트 커버리지 100% - 토스컨퍼런스(SLASH21)
2021년 4월 28일 토스에서 발표한 테스트 커버리지 100% 영상 정리

## 내용
- 테스트 커버리지 50% ~ 100% 까지 2개월 소요
  - 커밋의 23%가 테스트 코드
- 일정 커버리지부터는 커버리지가 낮으면 배포가 되지 않도록 설정
  - 계속적인 테스트 커버리지 유지를 위해 배포에 관해 설정
  - gradle jacoco => jacocoTestCoverageVerification 을 통해 설정
- 장점
  - 자신있게 배포할 수 있음
  - 거침없는 리팩토링
  - 불필요한 프로덕션 코드가 사라짐
    - 테스트를 모두 작성하다보면 불필요한 프로덕션 코드를 볼 수 있다
  - 프로덕션 코드에 대해 이해도 상승
  - 테스트 작성의 난이도가 점점 쉬워짐
- 어려움
  - 느려지는 테스트
    - IntelliJ 의 내장 프로파일러 async-profiler 를 이용해 성능 측정
    - 스프링 애플리케이션 컨텍스트 로딩 같이 오래걸리는 테스트를 최대한 제외시킴 => WebTestClient 는 컨텍스트 로딩 없이 테스트 가능 => 제거가 어려운 경우 static mocking 사용
    - SLF4J 초기화 : 불필요 로깅 설정 제거
    - Jackson ObjectMapper 생성 : Gson 으로 교체
    - Handlebars 컴파일 : 캐시 적용
    - Byte Buddy 초기화 : 테스트에서 제외
    - 코틀린 리플렉션 모듈 초기화 : isSubclassOf 함수 호출 제거
    - MockK : 필수적이지 않으면 모두 제거
    - 테스트의 순차적 실행 : 테스트를 클래스 단위로 병렬 실행
  - 어쩔수없이 테스트하기 어려운 코드
    - 코틀린이 생성한 바이트 코드 : 조금 우회적인 방법으로 테스트 달성
- 커버리지가 100% 가 되어도 버그는 있음
  - 테스트를 잘못 작성
  - 요구사항을 잘못이해
  - 컴포넌트간 협업 실패
  - 테스트 케이스가 부족하면 버그를 잡을 수 없음 => 논리적으로도 테스트가 맞는지 검증해야 한다. 검증하는 도구도 있지만 성능 등의 문제가 있다
- 테스트로 스펙 문서 만들기
  - JUnit5의 TestExecutionListener 구현을 통해 비개발자가 보기 쉬운 스펙 문서를 생성할 수 있다.
  - 하지만 테스트를 작성할때마다 시간을 많이 들여야해서 스펙문서를 제대로 작성하는 것은 비효율적이기도 하다 => 개인적인 생각으로는 인수테스트를 잘 작성함으로써 해결하도록 노력을 해보는 것이 좋을 것 같다

---
[발표영상](https://toss.im/slash-21/sessions/1-6)